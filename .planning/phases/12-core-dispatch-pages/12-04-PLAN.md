---
phase: 12-core-dispatch-pages
plan: 04
type: execute
wave: 2
depends_on: [12-01]
files_modified: [index.html]
autonomous: true

must_haves:
  truths:
    - "Trip Detail stat cards use design system tokens for padding, font-size, and border-radius"
    - "Trip Detail financial stat cards use color-coded styling (green=revenue, blue=clean revenue, amber=driver cut, conditional green/red=net profit)"
    - "Trip Detail pricing widget uses design system tokens for border-radius, font-sizes, and font-weights"
    - "Trip Detail vehicle direction headers and tables use design system tokens"
    - "Trip Detail expenses table and miles card use design system tokens"
    - "All existing functionality preserved: back navigation, trip status buttons, add vehicle, add expense, trip map, edit miles, vehicle actions"
  artifacts:
    - path: "index.html"
      provides: "Restyled viewTrip() function"
      contains: "var(--radius)"
  key_links:
    - from: "index.html viewTrip()"
      to: "assets/css/design-system.css"
      via: "CSS token references"
      pattern: "var\\(--radius\\)|var\\(--text-sm\\)|var\\(--weight-semibold\\)"
---

<objective>
Restyle the Trip Detail page (viewTrip function) to use mockup design system styling. Replace hardcoded font sizes, paddings, border radii, and font weights with design system CSS tokens. Apply consistent color coding to financial metrics.

Purpose: Trip Detail is a critical page for dispatchers to review trip financials, vehicle assignments, and expenses. Design system consistency improves readability and professionalism.

Output: Updated viewTrip() in index.html with design system tokens replacing inline style values.
</objective>

<execution_context>
@/Users/reepsy/.claude/get-shit-done/workflows/execute-plan.md
@/Users/reepsy/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-core-dispatch-pages/12-CONTEXT.md
@.planning/phases/12-core-dispatch-pages/12-RESEARCH.md
@mockups/web-tms-redesign/trip-detail.html
@assets/css/design-system.css
@index.html (lines 16084-16238 for viewTrip)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Restyle Trip Detail header, stat cards, and pricing widget</name>
  <files>index.html</files>
  <action>
  In viewTrip() (starts at line 16084), apply design system token substitutions to the header area and stat cards row. CRITICAL: Only change inline style values. Do NOT change JavaScript logic, onclick handlers, data calculations, or template literal expressions.

  **1. Header (line ~16225):**
  - Replace `gap:16px` with `gap:var(--spacing-4)` in header flex container
  - Replace `gap:12px` with `gap:var(--spacing-3)` in action buttons div
  - Keep all button onclick handlers and badge classes exactly as-is

  **2. Stat cards row (line ~16227):**
  This is a long flex row of stat-card divs. Apply these token substitutions:
  - Replace all `padding:12px 16px` with `padding:var(--spacing-3) var(--spacing-4)`
  - Replace `font-size:16px` with `font-size:var(--text-base)`
  - Replace `font-size:14px` with `font-size:var(--text-sm)`
  - Replace `font-size:12px` with `font-size:var(--text-xs)`
  - Replace `border-radius:8px` (if any) with `border-radius:var(--radius)`
  - Replace `margin-left:12px` with `margin-left:var(--spacing-3)`
  - Replace `margin-bottom:20px` with `margin-bottom:var(--spacing-5)` on the container div
  - Replace `gap:12px` with `gap:var(--spacing-3)` on the container div
  - Keep all conditional color logic (e.g., `f.netProfit >= 0 ? 'var(--green-dim)' : 'var(--red-dim)'`) exactly as-is

  **3. Pricing widget (lines ~16163-16222):**
  This is a template literal block using backtick strings. Apply these substitutions:
  - Replace `border-radius:16px` with `border-radius:var(--radius-xl)`
  - Replace `padding:20px` with `padding:var(--spacing-5)`
  - Replace `padding:12px 16px` with `padding:var(--spacing-3) var(--spacing-4)`
  - Replace `border-radius:12px` with `border-radius:var(--radius-lg)`
  - Replace `font-size:12px` with `font-size:var(--text-xs)`
  - Replace `font-size:24px` with `font-size:var(--text-2xl)`
  - Replace `font-size:13px` with `font-size:var(--text-sm)`
  - Replace `font-size:10px` — keep as-is (no token for 10px)
  - Replace `font-size:20px` with `font-size:var(--text-xl)`
  - Replace `font-weight:800` with `font-weight:var(--weight-heavy)`
  - Replace `font-weight:700` with `font-weight:var(--weight-bold)`
  - Replace `font-weight:600` with `font-weight:var(--weight-semibold)`
  - Replace `border-radius:8px` with `border-radius:var(--radius)`
  - Replace `gap:16px` with `gap:var(--spacing-4)`, `gap:12px` with `gap:var(--spacing-3)`
  - Replace `margin-bottom:16px` with `margin-bottom:var(--spacing-4)`, `margin-bottom:12px` with `margin-bottom:var(--spacing-3)`
  - Replace `margin-top:12px` with `margin-top:var(--spacing-3)`, `margin-top:4px` with `margin-top:var(--spacing-1)`
  - Replace `padding:16px` with `padding:var(--spacing-4)`, `padding:10px` with `padding:var(--spacing-2-5)`, `padding:12px` with `padding:var(--spacing-3)`
  - Keep all dynamic color expressions (${pricingGuidance.statusColor}, conditional ternaries) exactly as-is
  </action>
  <verify>
  1. Search for `var(--spacing-3) var(--spacing-4)` in viewTrip stat cards — should find multiple instances
  2. Search for `var(--text-sm)` in viewTrip — should find it
  3. Search for `var(--radius-lg)` in viewTrip pricing widget — should find it
  4. All onclick handlers preserved (renderTrips back button, openTripModal, openAssignDriver, openAssignTruck, openAddVehicle, openAddExpense, openTripMap)
  5. All conditional color logic preserved (netProfit >= 0 checks, pricingGuidance.statusColor references)
  </verify>
  <done>
  Trip Detail header, stat cards, and pricing widget use design system tokens for all hardcoded spacing, typography, border-radius, and font-weight values.
  </done>
</task>

<task type="auto">
  <name>Task 2: Restyle Trip Detail vehicle tables, expenses, and miles sections</name>
  <files>index.html</files>
  <action>
  Continue in viewTrip() applying design system token substitutions to the vehicle direction sections, expense table, and miles card.

  **1. Vehicle direction headers (lines ~16120, ~16143):**
  - Replace `padding:12px 16px` with `padding:var(--spacing-3) var(--spacing-4)`
  - Replace `font-weight:700` with `font-weight:var(--weight-bold)`
  - Replace `margin-top:16px` with `margin-top:var(--spacing-4)`
  - Replace `border-radius:8px 8px 0 0` with `border-radius:var(--radius) var(--radius) 0 0`
  - Replace `border-radius:0 0 8px 8px` with `border-radius:0 0 var(--radius) var(--radius)`
  - Replace `margin-bottom:8px` with `margin-bottom:var(--spacing-2)`

  **2. Vehicle table rows (lines ~16122-16133, ~16145-16155):**
  - Note rows: Replace `padding:8px 16px` with `padding:var(--spacing-2) var(--spacing-4)`, `font-size:13px` with `font-size:var(--text-sm)`
  - Subtotal rows: Keep as-is (already uses var(--bg-app))
  - Sticky-col is already applied — no changes needed
  - Collection badges: Keep inline badge styles as-is (they use var() colors)

  **3. Vehicle section wrapper (line ~16232):**
  - Replace `padding:16px` with `padding:var(--spacing-4)`
  - Replace `padding:40px` on empty state with `padding:var(--spacing-10)`

  **4. Expenses section (line ~16235):**
  - Replace `padding:40px` on empty state with `padding:var(--spacing-10)`
  - Expense rows already use .badge and .action-btn classes — no changes needed

  **5. Miles card (line ~16237):**
  - Replace `padding:20px` with `padding:var(--spacing-5)`
  - Replace `gap:20px` with `gap:var(--spacing-5)`
  - Replace `font-size:32px` with `font-size:var(--text-4xl)` (or `font-size:32px` if no token — check design-system.css)
  - Replace `font-weight:700` with `font-weight:var(--weight-bold)`

  IMPORTANT constraint from CONTEXT.md:
  - Do NOT restructure vehicle direction tables — keep the existing colored header + bordered table wrapper pattern
  - Do NOT add A/B route markers or arrow icons — they don't exist in production
  </action>
  <verify>
  1. Search for `var(--spacing-4)` in viewTrip vehicle sections — should find it
  2. Search for `var(--text-sm)` in viewTrip note rows — should find it
  3. Search for `var(--spacing-10)` in viewTrip empty states — should find it
  4. All vehicle table onclick handlers preserved (openOrderDetailPage, openEditVehicle, removeOrder)
  5. Vehicle direction header colors still dynamic (dir.color references preserved)
  6. Miles card edit button onclick preserved (openEditMiles)
  </verify>
  <done>
  Trip Detail vehicle direction tables, expense section, and miles card use design system tokens for all hardcoded spacing and typography values. All interactive behavior preserved.
  </done>
</task>

</tasks>

<verification>
1. viewTrip still renders: header with back/status/action buttons, stat cards row, pricing widget, vehicles by direction, expenses, miles
2. All financial calculations displayed correctly (broker fees, local fees, revenue, clean revenue, driver cut, net profit)
3. Vehicle direction sections still show colored headers with direction label and revenue totals
4. All interactive elements work: back button, status buttons, add vehicle, add expense, trip map, edit miles, vehicle row actions
5. No hardcoded px values for font-size, padding, border-radius where design tokens exist
</verification>

<success_criteria>
- Trip Detail page uses design system tokens for all inline style values
- Financial color coding preserved (green=revenue, blue=clean revenue, amber=driver cut, red/green=net profit)
- Vehicle direction table headers retain their dynamic color coding
- Pricing widget retains all conditional formatting
- Zero JavaScript logic changes
- All interactive elements fully functional
</success_criteria>

<output>
After completion, create `.planning/phases/12-core-dispatch-pages/12-04-SUMMARY.md`
</output>
