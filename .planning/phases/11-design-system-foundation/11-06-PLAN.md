---
phase: 11-design-system-foundation
plan: 06
type: execute
wave: 1
depends_on: []
files_modified:
  - index.html
  - assets/css/design-system.css
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "All non-intentional hex colors in index.html are replaced with CSS variable references"
    - "Sidebar nav section label class name matches between design-system.css and index.html"
    - "Nav styling exists only in design-system.css (no duplicates in index.html style block)"
  artifacts:
    - path: "index.html"
      provides: "Zero non-intentional hex colors remaining"
      contains: "var(--bg-card)"
    - path: "assets/css/design-system.css"
      provides: "Nav section label class matching HTML usage"
      contains: ".nav-section-title"
  key_links:
    - from: "index.html renderNav()"
      to: "assets/css/design-system.css"
      via: "CSS class .nav-section-title"
      pattern: "nav-section-title"
---

<objective>
Close 2 verification gaps from Phase 11 VERIFICATION.md:
1. Replace 12 remaining non-intentional hex colors with CSS variable references
2. Fix nav section label class name mismatch and remove duplicate nav styling from index.html

Purpose: Complete DSF-06 (all hardcoded hex replaced) and GLC-01 (sidebar styled correctly) requirements that were flagged as partial/blocked in verification.
Output: index.html and design-system.css with zero verification gaps remaining.
</objective>

<execution_context>
@/Users/reepsy/.claude/get-shit-done/workflows/execute-plan.md
@/Users/reepsy/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/11-design-system-foundation/11-VERIFICATION.md
@.planning/phases/11-design-system-foundation/11-05-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace remaining non-intentional hex colors with CSS variables</name>
  <files>index.html</files>
  <action>
Replace these specific hex colors in index.html with CSS variable equivalents. Each replacement is listed with exact line context:

**Photo gallery styles (lines ~2339-2367):**
- Line 2339: `background: #000;` → `background: var(--bg-elevated);`
  (Photo gallery main dark background — elevated surface for contrast)
- Line 2362: `color: #111;` → `color: var(--text-primary);`
  (Photo gallery nav arrow text color)
- Line 2367: `background: #fff;` → `background: var(--bg-card);`
  (Photo gallery nav hover background)

**Chat styling - light mode (lines ~4103-4152):**
- Line 4103: `background: #ffffff;` → `background: var(--bg-card);`
  (Chat container background)
- Line 4109: `linear-gradient(135deg, var(--bg-app) 0%, #ffffff 100%)` → `linear-gradient(135deg, var(--bg-app) 0%, var(--bg-card) 100%)`
  (Chat header gradient endpoint)
- Line 4122: `background: #ffffff;` → `background: var(--bg-card);`
  (Chat input area background)
- Line 4129: `background: #ffffff;` → `background: var(--bg-card);`
  (Chat message other background)
- Line 4152: `background: #ffffff;` → `background: var(--bg-card);`
  (Mini-chat input background)

**Sticky table column (line ~7836):**
- Line 7836: `background: #ffffff !important;` → `background: var(--bg-card) !important;`
  (Sticky table column needs card background for theme support)

**Skip link accessibility (line ~7976):**
- Line 7976: `color: #000;` → `color: var(--text-primary);`
  (Skip link text color)

**Video thumbnail in JS render (line ~13507):**
- Line 13507: `background:#000;` → `background:var(--bg-elevated);`
  (Video thumbnail dark background in inspection detail render)

**iOS install prompt in JS render (line ~36058):**
- Line 36058: `color:#333;` → `color:var(--text-primary);`
  (Share button icon color in iOS install prompt)

**Lines to NOT change (intentional — documented as acceptable):**
- Line 10: meta theme-color `#22c55e` (HTML meta tag, not CSS)
- Lines 3196-3199: `#ffffff`, `#fff` in CSS attribute selectors (detection patterns for dark mode override)
- Lines 3298, 3578, 3631, 3639: Dark login page custom backgrounds
- Lines 4359-4360: `#fff` in CSS attribute selectors (detection patterns)
- Line 6814: `#0a1014` as var() fallback (defensive, --bg-secondary IS defined)
- Line 9166: `&#039;` is an HTML entity, not a hex color
  </action>
  <verify>
Run these grep commands from the project root to confirm results:

1. Count remaining hex colors (should be ~14 intentional only):
   `grep -n '#[0-9a-fA-F]\{3,8\}' index.html | grep -v '&#039' | grep -v 'theme-color' | grep -v 'var(--' | grep -v '\.dark-theme \[style' | wc -l`
   Expected: approximately 4-6 lines (meta tag, login dark backgrounds, print style fallback)

2. Verify no #ffffff remains outside of attribute selectors:
   `grep -n '#ffffff' index.html | grep -v 'style\*='`
   Expected: 0 lines

3. Verify no #000 remains (except in rgba patterns):
   `grep -n 'background:#000[^0-9a-f]' index.html`
   Expected: 0 lines

4. Verify the chat container now uses var:
   `grep -n 'chat-container' index.html | head -3`
   Expected: `background: var(--bg-card)`
  </verify>
  <done>
All 12 non-intentional hex colors replaced with CSS variables. Only truly intentional hex colors remain (meta tags, dark login backgrounds, CSS attribute selectors for dark mode detection). DSF-06 requirement satisfied.
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix nav section label class mismatch and remove duplicate nav styles</name>
  <files>assets/css/design-system.css, index.html</files>
  <action>
Fix the class name mismatch between design-system.css and index.html for nav section labels.

**Strategy:** Update design-system.css to use `.nav-section-title` (matching what the HTML already uses). This is the lower-risk approach — the HTML class is used by renderNav() in JS and by the style block. Changing design-system.css (1 occurrence) is safer than changing JS render code.

**Step 1: Update design-system.css**
- In design-system.css, find `.nav-section-label` (around line 525)
- Change class name from `.nav-section-label` to `.nav-section-title`
- Keep all the property values identical (padding, font-size, font-weight, color, text-transform, letter-spacing)

**Step 2: Remove duplicate nav styles from index.html style block**
- In index.html, find the duplicate `.nav-section-title` definition in the style block (around lines 285-292)
- Remove the duplicate `.nav-section-title` block entirely (lines 285-292: `padding: 8px 20px; font-size: 11px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px;`)
- Keep the `.nav-section { margin-bottom: 4px; }` rule on line 284 — that's fine to keep or remove (it's also in design-system.css)
- Also remove the duplicate `.nav-item` styles from the index.html style block (lines 294-337) IF they are exact duplicates of design-system.css. Check carefully — if the index.html version has extra properties like `position: relative` or `overflow: hidden` that design-system.css lacks, keep those as overrides or add them to design-system.css instead.
- Remove the `.nav-badge` definition from index.html style block (lines 339-352) IF it's duplicated in design-system.css. If not in design-system.css, leave it.

**IMPORTANT:** Only remove styles from index.html that are EXACT duplicates of what design-system.css provides. If index.html adds properties that design-system.css doesn't have, either:
(a) Add those properties to design-system.css, then remove from index.html, OR
(b) Keep them in index.html as overrides

The goal is design-system.css as single source of truth for nav styling.
  </action>
  <verify>
1. Confirm class name match:
   `grep 'nav-section-label' assets/css/design-system.css`
   Expected: 0 results (old class name gone)

2. Confirm new class name in design-system.css:
   `grep 'nav-section-title' assets/css/design-system.css`
   Expected: 1 result

3. Confirm HTML still uses correct class:
   `grep 'nav-section-title' index.html`
   Expected: at least 1 result in renderNav() (line ~12886)

4. Confirm no duplicate nav-section-title in index.html style block:
   Search lines 280-295 of index.html for `.nav-section-title` — should NOT be found in the `<style>` block anymore (only in JS renderNav output)
  </verify>
  <done>
Nav section label class name `.nav-section-title` matches between design-system.css and index.html. Duplicate nav styling removed from index.html style block. design-system.css is the single source of truth for all sidebar navigation styles. GLC-01 requirement fully satisfied.
  </done>
</task>

</tasks>

<verification>
After both tasks:

1. **Hex color audit:** Run comprehensive grep for hex colors in index.html. Only intentional hex colors should remain:
   - Line 10: meta theme-color (#22c55e)
   - Lines 3196-3199: dark-theme attribute selector patterns
   - Lines 3298, 3578, 3631, 3639: dark login backgrounds
   - Lines 4359-4360: dark-theme attribute selector patterns
   - Line 6814: var() fallback (acceptable)

2. **Nav class consistency:** `grep -r 'nav-section-label' assets/css/` should return 0 results. `grep -r 'nav-section-title' assets/css/ index.html` should show design-system.css definition and index.html renderNav() usage.

3. **No regressions:** Open index.html in browser. Navigate sidebar. Verify:
   - Section labels (DISPATCH, FLEET, FINANCIAL, etc.) render with correct uppercase/muted styling
   - Chat page light mode background is white (card color), not broken
   - Photo gallery nav buttons display correctly
   - Theme toggle still works across all pages

4. **Re-verify VERIFICATION.md truths:**
   - Truth 3 (hex colors): Should now be VERIFIED (all non-intentional replaced)
   - Truth 4 (sidebar): Should now be VERIFIED (class name matches, single source of truth)
</verification>

<success_criteria>
- Zero non-intentional hex colors in index.html (only meta tags, login dark backgrounds, and CSS attribute selectors remain)
- `.nav-section-title` class defined in design-system.css (not `.nav-section-label`)
- No duplicate nav styling in index.html `<style>` block — design-system.css is sole authority
- DSF-06 requirement: SATISFIED
- GLC-01 requirement: SATISFIED
- All 5 Phase 11 truths verified
</success_criteria>

<output>
After completion, create `.planning/phases/11-design-system-foundation/11-06-SUMMARY.md`
</output>
