---
phase: 11-design-system-foundation
plan: 04
type: execute
wave: 4
depends_on: ["11-03"]
files_modified:
  - index.html
  - assets/css/design-system.css
autonomous: false

must_haves:
  truths:
    - "Theme toggle switches between light and dark themes with ALL colors updating correctly across every page"
    - "Sidebar navigation matches mockup styling (green active indicator, hover states, section labels, icons) with production nav order preserved"
    - "All global components (modals, toasts, tables, forms, buttons, badges, cards, pagination) visually match mockup across both themes"
    - "No visual breakage on any page (checked on Dashboard, Orders, Drivers, Financials, Settings, Compliance)"
    - "Theme preference persists across page refresh"
  artifacts:
    - path: "index.html"
      provides: "Production TMS with complete design system applied"
    - path: "assets/css/design-system.css"
      provides: "Complete production design system"
  key_links:
    - from: "assets/css/design-system.css"
      to: "index.html"
      via: "CSS custom properties consumed throughout"
      pattern: "var\\(--"
---

<objective>
Final verification and fixup pass for Phase 11. Audit the entire production app for visual correctness, fix any remaining issues (missed hex colors, broken component styles, theme toggle gaps), and verify all Phase 11 success criteria are met.

Purpose: This is the quality gate before Phase 11 is marked complete. It catches any issues from the hex replacement sweeps (plans 01-03), fixes edge cases, and provides a visual verification checkpoint with the user.

Output: A fully-verified production app where the design system is complete and all global components match mockup styling.
</objective>

<execution_context>
@/Users/reepsy/.claude/get-shit-done/workflows/execute-plan.md
@/Users/reepsy/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-design-system-foundation/11-CONTEXT.md
@.planning/phases/11-design-system-foundation/11-03-SUMMARY.md
@assets/css/design-system.css
@mockups/web-tms-redesign/shared.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Audit and fix remaining hex colors and CSS issues</name>
  <files>index.html, assets/css/design-system.css</files>
  <action>
Run a comprehensive audit of the completed migration:

1. **Remaining hex colors audit:**
   - `grep -oE '#[0-9a-fA-F]{6}\b' index.html | sort | uniq -c | sort -rn` -- review every remaining hex
   - For each remaining hex: determine if it's in a style context (needs replacement) or non-style context (JS logic, data, meta tag -- OK to keep)
   - Replace any missed style-context hex colors with var() references
   - Target: Under 30 hex colors remaining, all in non-style contexts

2. **rgba() audit:**
   - `grep -n 'rgba(' index.html | head -50` -- check if any rgba() values should use dim tokens
   - Common patterns: `rgba(34, 197, 94, 0.*)` -> `var(--green-dim)`, `rgba(239, 68, 68, 0.*)` -> `var(--red-dim)`
   - Replace rgba values that match dim token patterns

3. **CSS variable audit:**
   - Check for any var() references to variables that don't exist in design-system.css
   - Search for `var(--` in index.html and cross-reference each unique variable against design-system.css `:root` block
   - Add any missing variables to design-system.css

4. **Component style completeness check:**
   Compare design-system.css component styles against mockup shared.css for any gaps:
   - Sidebar styles complete? (nav-item, nav-section, sidebar-logo, collapsed state)
   - Header styles complete? (search, avatar, theme-toggle)
   - Modal styles complete? (overlay, modal, header, body, footer, close)
   - Table styles complete? (container, thead, th, td, hover, mono)
   - Button styles complete? (primary, secondary, danger, ghost, sm, lg, icon)
   - Badge styles complete? (green, amber, blue, red, purple, gray, outline)
   - Form styles complete? (form-group, input, select, textarea, focus, error)
   - Card styles complete? (card, card-hover, stat-card, hero-card)
   - Toast styles present? (toast, success, error, warning, info)
   - Pagination styles present?
   - Spinner/loading styles present?

5. **Dark theme verification:**
   - Verify body.dark-theme block in design-system.css has all tokens overridden
   - Check for any CSS rules that use `[data-theme="light"]` (mockup pattern) instead of `:root` (production pattern) -- fix any mismatches

If any issues found, fix them. Document what was fixed.
  </action>
  <verify>
Run:
1. `grep -oE '#[0-9a-fA-F]{6}\b' index.html | wc -l` -- under 30
2. `grep -c 'var(--' index.html` -- should be 3000+ (significantly up from original ~2444)
3. No undefined CSS variables: extract unique var names from index.html and check each exists in design-system.css
  </verify>
  <done>All remaining hex colors in style contexts are replaced. All CSS variables referenced in index.html are defined in design-system.css. All global component styles are complete and match mockup design.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete design system migration for Phase 11:
- design-system.css contains all CSS tokens from mockup shared.css
- All ~1,734 hardcoded hex colors in index.html replaced with var() references
- Toast, spinner, pagination, and accessibility styles added
- All global components (sidebar, header, modals, tables, buttons, badges, forms, cards) styled to match mockup
- Theme toggle (light/dark) works across all pages
  </what-built>
  <how-to-verify>
Open index.html in your browser and verify the following:

**1. Theme Toggle (DSF-01 through DSF-06)**
- Click the theme toggle button in the header
- Verify ALL colors switch between light and dark themes
- Refresh the page -- theme preference should persist
- Toggle back -- verify it returns to the previous theme correctly

**2. Sidebar (GLC-01)**
- Sidebar has correct mockup styling: border-right, green active indicator (left border), hover states
- Nav section labels show in uppercase muted text
- Collapsed sidebar hides labels, centers icons
- Production nav order is preserved (same items as before, same order)

**3. Header (GLC-02)**
- Search bar styled with bg-app background and green focus ring
- Theme toggle button styled correctly
- User avatar shows green-dim background

**4. Modals (GLC-03)**
- Open any modal (e.g., create a new order) -- backdrop blur, rounded corners, smooth scale animation
- Close via X button, Escape key, and backdrop click -- all work

**5. Tables (GLC-05)**
- Navigate to Orders or Trips page -- table has styled header (elevated background, uppercase labels)
- Row hover highlights
- Pagination controls styled at bottom

**6. Buttons (GLC-07)**
- Primary buttons: green background, white text, hover brightens + slight lift
- Secondary buttons: transparent with border, hover fills
- Danger buttons: red background

**7. Badges (GLC-08)**
- Status badges on Orders/Trips pages show color-coded indicators (green, amber, red, blue)
- Each badge type is visually distinct in both themes

**8. Forms (GLC-06)**
- Navigate to Settings -- form inputs have bg-app background, green focus ring
- Select dropdowns have custom chevron icon

**9. Toasts (GLC-04)**
- Trigger a save action -- toast appears with slide-in animation, colored left border

**10. Cards (GLC-09)**
- Dashboard cards have bg-card background, border, shadow
- Stat cards have colored icons with dim backgrounds

**11. Cross-Page Check**
Navigate through these key pages and verify no visual breakage:
- Dashboard
- Orders (list + detail)
- Trips
- Drivers
- Financials
- Settings
- Compliance
- Fuel Tracking
  </how-to-verify>
  <resume-signal>Type "approved" to complete Phase 11, or describe any visual issues that need fixing.</resume-signal>
</task>

</tasks>

<verification>
Phase 11 success criteria check:
1. design-system.css contains ALL CSS tokens from mockup shared.css -- YES
2. Theme toggle switches between light/dark with all colors updating -- VERIFIED by user
3. All hardcoded hex colors replaced with CSS variable references -- YES (under 30 remaining, all non-style)
4. Sidebar matches mockup styling with production nav order -- VERIFIED by user
5. All global components visually match mockups across both themes -- VERIFIED by user
</verification>

<success_criteria>
- User approves visual verification checkpoint
- Phase 11 all 5 success criteria satisfied
- All 16 requirements (DSF-01 through DSF-06, GLC-01 through GLC-10) met
- Ready to proceed to Phase 12 (Core Dispatch Pages)
</success_criteria>

<output>
After completion, create `.planning/phases/11-design-system-foundation/11-04-SUMMARY.md`
</output>
