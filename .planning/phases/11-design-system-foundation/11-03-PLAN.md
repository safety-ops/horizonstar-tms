---
phase: 11-design-system-foundation
plan: 03
type: execute
wave: 3
depends_on: ["11-02"]
files_modified:
  - index.html
autonomous: true

must_haves:
  truths:
    - "All hex colors in index.html lines 22001-38085 are replaced with var() CSS variable references"
    - "Theme toggle correctly switches colors in Compliance, Payroll, Billing, Financials, Maintenance, Settings, LiveMap, TeamChat, Reports, AI Advisor, Applications, and Dealer portal render functions"
    - "No visual regressions -- all pages render correctly in both themes"
    - "Total hex color count across entire index.html is under 50 (allowing for non-style contexts like meta tags, data attributes)"
  artifacts:
    - path: "index.html"
      provides: "Lines 22001-38085 with var() references instead of hex colors"
  key_links:
    - from: "index.html"
      to: "assets/css/design-system.css"
      via: "var() references resolve to design system tokens"
      pattern: "var\\(--"
---

<objective>
Replace all hardcoded hex colors in index.html JavaScript render functions (lines 22001-38085) with CSS variable references.

Purpose: This is the second and final half of the hex color migration in JS render functions. These lines cover: Compliance detail, Payroll, Billing, Financials, Trip Profitability, Fixed/Variable Costs, Maintenance, Settings, LiveMap, TeamChat, Notifications, Users, ActivityLog, Reports, AI Advisor, Applications, and Dealer portal. After this plan, the ENTIRE index.html will use CSS variables for colors, making theme toggle work everywhere.

Output: index.html lines 22001-38085 with zero (or near-zero) hardcoded hex colors. Combined with plans 01 and 02, the entire file will be theme-toggle-ready.
</objective>

<execution_context>
@/Users/reepsy/.claude/get-shit-done/workflows/execute-plan.md
@/Users/reepsy/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-design-system-foundation/11-CONTEXT.md
@.planning/phases/11-design-system-foundation/11-02-SUMMARY.md
@assets/css/design-system.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace hex colors in lines 22001-30000 (Compliance detail, Payroll, Billing, Financials, Trip Profitability, Fixed/Variable Costs)</name>
  <files>index.html</files>
  <action>
Systematically scan index.html lines 22001-30000 and replace every hardcoded hex color with the appropriate CSS variable reference. This range covers these render functions:
- `renderComplianceDrivers` and compliance sub-sections (~line 22239+)
- `renderAccidentRegistry` (~line 22127)
- Payroll render functions (~line 22000-24000 area)
- Billing/Invoicing render functions
- `renderPayroll`, `renderBilling` and related modals
- `renderFinancials` and financial sub-tabs (~line 25000+ area)
- `renderFinByLane` (~line 28941)
- `renderTripProfitability` (~line 29026)
- `renderFixedCosts` (~line 29582)
- `renderVariableCosts` (~line 29647)
- `renderFinancialAnalysis` (~line 29807)

There are approximately 535 hex color occurrences in this range (lines 22001-30000 had 295 + additional inline style blocks around 25800-28129).

**Color mapping (same as Plans 01/02):**

Green family: `#22c55e`/`#16a34a`/`#059669`/`#047857`/`#15803d`/`#166534`/`#4ade80`/`#10b981` -> `var(--green)` or appropriate primary-N00 spectrum var
Light green backgrounds: `#d1fae5`/`#dcfce7`/`#bbf7d0`/`#f0fdf4`/`#ecfdf5` -> `var(--green-dim)`

Red family: `#ef4444`/`#dc2626`/`#991b1b`/`#f87171` -> `var(--red)`
Light red backgrounds: `#fee2e2`/`#fecaca` -> `var(--red-dim)`

Amber family: `#f59e0b`/`#d97706` -> `var(--amber)`
Light amber backgrounds: `#fef3c7`/`#fffbeb`/`#fefce8` -> `var(--amber-dim)`

Blue family: `#3b82f6`/`#2563eb`/`#1d4ed8`/`#1e40af` -> `var(--blue)`
Light blue backgrounds: `#dbeafe`/`#bfdbfe`/`#eff6ff` -> `var(--blue-dim)`

Purple family: `#8b5cf6`/`#7c3aed`/`#6b21a8`/`#4c1d95` -> `var(--purple)`

Gray/Neutral: same mapping as previous plans.

**Context-sensitive rules:**
- Financial pages have money-colored text (green for positive, red for negative) -- use `var(--green)` and `var(--red)`
- Payroll pages have status colors for paid/unpaid/pending -- use appropriate brand tokens
- Charts/graphs may have multiple series colors -- use brand color tokens (green, blue, amber, red, purple)
- Settings page has form inputs -- ensure input border/focus colors use tokens
- Any `<style>` blocks within this range (lines 25800-26090, 27902-28129) should also have their hex colors replaced

**CRITICAL constraints:**
- Do NOT change any JavaScript logic, function signatures, variable names, or conditional expressions
- Do NOT change HTML tags, class names, or DOM structure
- ONLY change color VALUES (hex strings) to var() references
- If hex is in JS comparison/data context, leave it
  </action>
  <verify>
Run: `awk 'NR>=22001 && NR<=30000' index.html | grep -oE '#[0-9a-fA-F]{6}\b' | wc -l`
Result should be under 20.
  </verify>
  <done>All hex colors in index.html lines 22001-30000 are replaced with CSS variable references. Compliance, Payroll, Billing, Financials, and profitability pages use design tokens.</done>
</task>

<task type="auto">
  <name>Task 2: Replace hex colors in lines 30001-38085 (Maintenance, Settings, LiveMap, TeamChat, Reports, AI, Applications, Dealers)</name>
  <files>index.html</files>
  <action>
Systematically scan index.html lines 30001-38085 and replace every hardcoded hex color with the appropriate CSS variable reference. This range covers these render functions:
- `renderProfitability` (~line 31030)
- `renderMaintenance` (~line 31328)
- `renderSettings` (~line 31513)
- `renderTripMapStopList` (~line 32114)
- `renderLiveMap` (~line 32778)
- `renderTeamChat` and related functions (~line 33003+)
- `renderMiniChat` variants (~line 34831+)
- `renderNotificationList` (~line 35369)
- `renderUsers` (~line 35537)
- `renderActivityLog` (~line 35585)
- `renderReports` and report sub-functions (~line 36082+)
- `renderAIAdvisor` and AI sub-tabs (~line 36381+)
- `renderApplications` (~line 37056)
- Dealer portal functions (~line 37477+)
- Any remaining `<style>` blocks in this range (lines 36465-36471)

There are approximately 606 hex color occurrences in this range (the densest section).

Use the SAME color mapping as Task 1. Apply the same context-sensitive rules and the same critical constraints.

Additional notes for this section:
- Team Chat has message bubble colors and online/offline status indicators -- use tokens
- LiveMap may have map-related colors in JavaScript -- only replace those in style attributes, NOT in map API configuration objects
- AI Advisor has tab colors and chat interface colors -- use tokens
- Dealer portal has its own branded sections -- still use design system tokens for theme support
- Settings page has theme preview areas -- be careful not to change the hex values that are DISPLAYED as examples (if any), only the ones used for styling
- Notification list has unread/read status colors -- use tokens
- Reports have chart colors -- replace with tokens for theme support

After completing this task, verify the ENTIRE file:
Run: `grep -oE '#[0-9a-fA-F]{6}\b' index.html | wc -l`
Target: Under 50 total across the entire 38K line file. The remaining hex values should be:
- Meta tags (line 10: theme-color)
- Non-style contexts (JS comparisons, data values)
- Intentional exceptions documented in code comments
  </action>
  <verify>
Run these checks:
1. `awk 'NR>=30001 && NR<=38085' index.html | grep -oE '#[0-9a-fA-F]{6}\b' | wc -l` should be under 25
2. `grep -oE '#[0-9a-fA-F]{6}\b' index.html | wc -l` (ENTIRE file) should be under 50
3. Open index.html in browser, navigate through Settings, Maintenance, Reports, AI Advisor -- all render correctly
4. Toggle theme -- ALL colors change across these pages
  </verify>
  <done>All hex colors in index.html lines 30001-38085 are replaced with CSS variable references. The entire index.html file now has under 50 hex color literals remaining (only in non-style contexts). Theme toggle works across ALL pages.</done>
</task>

</tasks>

<verification>
After both tasks complete, run comprehensive file-wide checks:
1. `grep -oE '#[0-9a-fA-F]{6}\b' index.html | wc -l` -- total under 50
2. Open index.html in browser, navigate to every major page:
   - Dashboard, LoadBoard, Trips, Orders, Drivers, Trucks
   - Payroll, Billing, Financials, Trip Profitability
   - Fuel, IFTA, Compliance, Maintenance
   - Tasks, Settings, Activity Log, Team Chat
   - Reports, AI Advisor, Applications
3. Toggle theme on each page -- all colors switch correctly
4. Check browser console for any CSS errors (undefined variables)
5. Verify no JavaScript errors (no accidental syntax changes)
</verification>

<success_criteria>
- Total hex color count in entire index.html under 50
- All render functions use var() references for color values
- Theme toggle correctly switches colors on ALL pages
- No JavaScript errors in console
- No visual regressions on any page
- Phase 11 requirement DSF-06 is fully satisfied: "All hardcoded hex colors in index.html replaced with CSS variable references"
</success_criteria>

<output>
After completion, create `.planning/phases/11-design-system-foundation/11-03-SUMMARY.md`
</output>
