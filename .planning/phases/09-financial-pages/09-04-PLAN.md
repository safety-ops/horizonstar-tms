---
phase: 09-financial-pages
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - mockups/web-tms-redesign/trip-profitability.html
autonomous: false

must_haves:
  truths:
    - "Trip Profitability page shows filter section with From/To dates, Driver dropdown, Truck dropdown, Status dropdown (All/Profitable/Unprofitable), and Clear Filters button"
    - "4 summary stat cards with colored dots show Total Revenue + trip count, Net Profit + margin %, Profitable Trips + success rate %, Avg Profit/Mile + total miles"
    - "Best/Worst performers section shows top 5 most profitable (green) and bottom 5 performers (red/amber) trips"
    - "Sortable trips table shows 12 columns including compare checkbox, all financial metrics, and color-coded margin (4-tier: green ≥20%, amber 10-19%, orange 0-9%, red <0%)"
    - "Compare checkbox allows selecting up to 3 trips, with Compare Selected button appearing in header when ≥2 selected"
    - "Trip comparison modal shows side-by-side metrics for selected trips"
    - "Export CSV button is visible in header"
    - "Light/dark theme toggle works correctly"
  artifacts:
    - path: "mockups/web-tms-redesign/trip-profitability.html"
      provides: "Complete trip profitability analysis page with filters, performers, sortable table, and comparison"
      min_lines: 600
  key_links:
    - from: "trip-profitability.html"
      to: "shared.css"
      via: "link rel stylesheet"
      pattern: 'href="./shared.css"'
    - from: "trip-profitability.html"
      to: "base-template.html"
      via: "copied app shell (sidebar + header + page-content)"
      pattern: "class=\"app-layout\""
---

<objective>
Create the Trip Profitability Analysis mockup page with filter bar, summary stats, best/worst performers, sortable trips table with compare checkboxes, and a trip comparison modal — all with realistic sample data demonstrating the full range of profitability.

Purpose: Trip Profitability is the analytical counterpart to the Trips list page, focused on financial performance rather than dispatch status. The sortable table with compare feature lets dispatchers identify profitable patterns and underperforming trips. The mockup must show the full range of profitability (highly profitable to loss-making) with 4-tier margin color coding.

Output: `mockups/web-tms-redesign/trip-profitability.html` — standalone HTML file with filter bar, stats, performers, table, and comparison modal.
</objective>

<execution_context>
@/Users/reepsy/.claude/get-shit-done/workflows/execute-plan.md
@/Users/reepsy/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-financial-pages/09-RESEARCH.md
@mockups/web-tms-redesign/shared.css
@mockups/web-tms-redesign/base-template.html
@mockups/web-tms-redesign/trips.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create trip-profitability.html with filters, performers, table, and comparison</name>
  <files>mockups/web-tms-redesign/trip-profitability.html</files>
  <action>
Create `trip-profitability.html` by copying the app shell from `base-template.html`. Set title to "Horizon Star TMS -- Trip Profitability" and mark the Trip Profitability nav item as `active`.

Inside `<div class="page-content">`, build the complete trip profitability page. The comparison modal is rendered inline as a visible section below the main content (this is a mockup).

**IMPORTANT CONSTRAINTS (from user decisions):**
- Green positive, red negative, ($X) accounting parentheses
- Stat cards use colored-dot indicator style
- 4-tier margin color coding: ≥20% green, 10-19% amber, 0-9% orange, <0% red
- Sortable table headers with ↕ icons
- Compare checkbox max 3 — disabled checkboxes when 3 already selected
- Monospace for monetary values in tables
- Alert/action banners for comparison feature

---

## SECTION A: MAIN VIEW

**A1. Header Row**
- Title: "Trip Profitability Analysis" with bar-chart icon
- Right: "Export CSV" button (btn-secondary, download icon) + "Compare Selected (2)" button (btn-primary, only visible when comparison active — show it active in mockup with 2 trips selected)

**A2. Filter Section**
- Card with bg-elevated background, padding 16px, border-radius var(--radius)
- Horizontal flex row (wrapping on mobile) with gap 12px:
  1. "From:" label + date input (value: "2025-12-01")
  2. "To:" label + date input (value: "2026-02-09")
  3. "Driver:" dropdown (options: All Drivers, John Smith, Maria Garcia, David Chen, Sarah Johnson, James Lee, Robert Williams)
  4. "Truck:" dropdown (options: All Trucks, T-101, T-102, T-103, T-104)
  5. "Status:" dropdown (options: All Trips, Profitable Only, Unprofitable Only)
  6. "Clear Filters" button (btn-ghost btn-sm)

**A3. Summary Stats Cards (4 cards, grid)**
Use `grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 16px;`
Each card: colored dot + label + large value + subtitle

1. Total Revenue: green dot, "$487,320.00" (green, large), "42 trips" (text-secondary)
2. Net Profit: green dot (positive), "$68,240.00" (green, large), "14.0% overall margin" (badge-amber since 10-19%)
3. Profitable Trips: green dot, "38" (green, large), "90.5% success rate" (text-secondary)
4. Avg Profit/Mile: green dot, "$0.28" (green, large), "245,680 total miles" (text-secondary)

**A4. Best/Worst Performers (2-column grid)**
Use `grid-template-columns: 1fr 1fr; gap: 16px;` (stack on mobile)

**Left Card: "Top 5 Most Profitable" (border-left 4px solid var(--green))**
- Header: trophy icon + "Top 5 Most Profitable"
- 5 list items (each a flex row with gap, padding 8px, border-bottom):
  1. "#1" (bold) | T-2026-0040 | $4,280.00 (green, mono) | 28.5% (badge-green)
  2. "#2" | T-2026-0042 | $3,200.00 (green) | 25.8% (badge-green)
  3. "#3" | T-2026-0038 | $2,880.00 (green) | 26.7% (badge-green)
  4. "#4" | T-2026-0032 | $2,540.00 (green) | 22.1% (badge-green)
  5. "#5" | T-2026-0035 | $2,300.00 (green) | 17.0% (badge-amber)

**Right Card: "Bottom 5 Performers" (border-left 4px solid var(--red))**
- Header: alert-triangle icon + "Bottom 5 Performers"
- 5 list items:
  1. "#1" (bold) | T-2026-0025 | ($420.00) (red, accounting) | -10.0% (badge-red)
  2. "#2" | T-2026-0022 | ($180.00) (red) | -4.3% (badge-red)
  3. "#3" | T-2026-0028 | $320.00 (amber) | 5.0% (badge-orange)
  4. "#4" | T-2026-0018 | $480.00 (amber) | 6.2% (badge-orange)
  5. "#5" | T-2026-0030 | $980.00 | 10.0% (badge-amber)

**A5. Trips Table**
- Note above table (text-muted): "Select trips to compare | Click headers to sort"
- Table wrapper with standard styling
- 12 columns (sortable headers with ↕ icons):

| Compare | Date ↕ | Trip # ↕ | Driver ↕ | Truck ↕ | Revenue ↕ | Broker Fees | Driver Pay | Expenses | Net Profit ↕ | Margin % ↕ | Actions |

- Actions column sticky right
- 12 data rows demonstrating full range. Mark rows 1 and 3 as "selected" (checkbox checked, light blue-dim background):

Row 1 (SELECTED, highly profitable):
- [✓] | Jan 28, 2026 | T-2026-0042 | John Smith | T-101 | $12,400.00 (green) | $1,116.00 (red) | $3,968.00 (red) | $480.00 (red) | $3,200.00 (green) | 25.8% (badge-green) | "View" btn-sm

Row 2:
- [ ] | Jan 25, 2026 | T-2026-0040 | Maria Garcia | T-103 | $15,020.00 | $1,352.00 | $4,506.00 | $620.00 | $4,280.00 (green) | 28.5% (badge-green) | View

Row 3 (SELECTED):
- [✓] | Jan 22, 2026 | T-2026-0038 | David Chen | T-101 | $10,800.00 | $972.00 | $3,456.00 | $380.00 | $2,880.00 (green) | 26.7% (badge-green) | View

Row 4:
- [ ] | Jan 18, 2026 | T-2026-0035 | Sarah Johnson | T-104 | $13,500.00 | $1,350.00 | $4,050.00 | $520.00 | $2,300.00 (green) | 17.0% (badge-amber) | View

Row 5:
- [ ] | Jan 15, 2026 | T-2026-0032 | James Lee | T-102 | $11,500.00 | $1,035.00 | $3,450.00 | $410.00 | $2,540.00 (green) | 22.1% (badge-green) | View

Row 6:
- [ ] | Jan 12, 2026 | T-2026-0030 | John Smith | T-101 | $9,800.00 | $882.00 | $3,136.00 | $340.00 | $980.00 (green) | 10.0% (badge-amber) | View

Row 7:
- [ ] | Jan 8, 2026 | T-2026-0028 | David Chen | T-102 | $6,400.00 | $576.00 | $2,048.00 | $280.00 | $320.00 (green) | 5.0% (badge-orange) | View

Row 8:
- [ ] | Jan 5, 2026 | T-2026-0025 | Robert Williams | T-102 | $4,200.00 | $378.00 | $1,344.00 | $250.00 | ($420.00) (red) | -10.0% (badge-red) | View

Row 9:
- [ ] | Jan 3, 2026 | T-2026-0022 | James Lee | T-103 | $4,180.00 | $376.00 | $1,338.00 | $220.00 | ($180.00) (red) | -4.3% (badge-red) | View

Row 10:
- [ ] | Dec 28, 2025 | T-2026-0018 | John Smith | T-101 | $7,700.00 | $693.00 | $2,464.00 | $310.00 | $480.00 (green) | 6.2% (badge-orange) | View

Row 11:
- [ ] | Dec 22, 2025 | T-2026-0015 | Sarah Johnson | T-104 | $11,200.00 | $1,008.00 | $3,360.00 | $420.00 | $1,820.00 (green) | 16.3% (badge-amber) | View

Row 12:
- [ ] | Dec 18, 2025 | T-2026-0012 | Maria Garcia | T-103 | $13,800.00 | $1,242.00 | $4,140.00 | $540.00 | $3,420.00 (green) | 24.8% (badge-green) | View

---

## SECTION B: TRIP COMPARISON MODAL (visible inline)

Use a visual separator heading: "TRIP COMPARISON (below)" between sections.

Render as a card with max-width 800px, centered, modal styling.

**B1. Modal Header**
- Title: "Trip Comparison" with scale/balance icon
- Subtitle: "Comparing 2 trips"

**B2. Comparison Table**
- 3-column layout: Metric | Trip T-2026-0042 | Trip T-2026-0038
- Rows (alternating background):
  1. Date: Jan 28, 2026 | Jan 22, 2026
  2. Driver: John Smith | David Chen
  3. Truck: T-101 | T-101
  4. Cars: 5 | 4
  5. Revenue: $12,400.00 (green) | $10,800.00 (green)
  6. Broker Fees: ($1,116.00) (red) | ($972.00) (red)
  7. Driver Pay: ($3,968.00) (red) | ($3,456.00) (red)
  8. Expenses: ($480.00) (red) | ($380.00) (red)
  9. **Net Profit**: **$3,200.00** (green, bold) | **$2,880.00** (green, bold)
  10. **Margin %**: **25.8%** (badge-green) | **26.7%** (badge-green)
  11. Revenue/Mile: $1.82 | $1.95
  12. Profit/Mile: $0.47 | $0.52
  13. Revenue/Car: $2,480.00 | $2,700.00

- Winner highlighting: For each metric, the better value gets a subtle green-dim background or bold treatment

**Styling notes:**
- Page-specific CSS in `<style>` tag for: filter section layout, performers list items, compare checkboxes/selected rows, sort icons, comparison table winner highlighting. Keep under 120 lines.
- Selected rows: `background: var(--blue-dim)` for checked comparison rows
- Sort icons: `cursor: pointer;` on th elements, ↕ as default, show they're interactive
- Compare checkboxes: standard checkboxes, disabled state for non-selected when 3 are chosen (not applicable in current mockup with only 2 selected)
- Performers list: alternating subtle backgrounds, each item a flex row
- Comparison table: 3 equal columns, metric column bold, alternating row backgrounds
  </action>
  <verify>
Open `mockups/web-tms-redesign/trip-profitability.html` in a browser. Verify:
1. Page loads without console errors
2. Header shows "Trip Profitability Analysis" with Export CSV and Compare Selected (2) buttons
3. Filter section with 6 controls (2 dates, 3 dropdowns, clear button)
4. 4 summary stat cards with colored dots and subtitle metrics
5. 2-column best/worst performers section (5 items each, green vs red)
6. Note text above table: "Select trips to compare | Click headers to sort"
7. 12-row table with all 12 columns
8. Rows 1 and 3 have checked checkboxes with blue-dim background
9. Revenue column green, Broker Fees/Driver Pay/Expenses red, Net Profit color-coded
10. Margin badges: green ≥20%, amber 10-19%, orange 0-9%, red <0%
11. 2 unprofitable trips show red ($X) values and red margin badges
12. Comparison modal section shows 13-metric side-by-side table for 2 trips
13. Better values in comparison get visual emphasis
14. Theme toggle works on all sections
  </verify>
  <done>trip-profitability.html exists with filter bar (6 controls), 4 summary stat cards (colored dots), best/worst performers (5 each), 12-row sortable table (compare checkboxes, all financial columns, 4-tier margin color coding), and trip comparison modal, using shared.css with working theme toggle</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete Trip Profitability Analysis mockup with filter bar (date range, driver/truck/status dropdowns), 4 summary stat cards with colored-dot indicators, best/worst performers section (5 each), 12-row sortable trips table with compare checkboxes (2 selected with blue highlighting), all financial columns with 4-tier margin color coding, Export CSV button, and trip comparison modal showing 13-metric side-by-side comparison.</what-built>
  <how-to-verify>
1. Open `mockups/web-tms-redesign/trip-profitability.html` in your browser
2. Verify header with Export CSV button and "Compare Selected (2)" active button
3. Verify filter section with From/To dates, 3 dropdowns, Clear Filters button
4. Verify 4 summary stat cards with colored dots (Revenue, Profit, Profitable Trips, Avg Profit/Mile)
5. Verify 2-column performers: Top 5 (green border, green values) and Bottom 5 (red border, red/amber values)
6. Verify 12-row table with all 12 columns including checkboxes
7. Check rows 1 and 3 have checked checkboxes and blue-dim background
8. Check margin color coding: green (≥20%), amber (10-19%), orange (0-9%), red (<0%)
9. Verify 2 unprofitable trips show ($X) red values and red badges
10. Scroll to comparison modal — verify 13-metric table comparing T-2026-0042 and T-2026-0038
11. Check winner highlighting in comparison
12. Toggle dark/light theme — all sections should look clean
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
- [ ] trip-profitability.html loads in browser without console errors
- [ ] Header: title, Export CSV button, Compare Selected (2) button
- [ ] Filter section: 2 date inputs, 3 dropdowns, Clear Filters button
- [ ] 4 summary stat cards with colored dots and subtitle metrics
- [ ] Best performers: 5 items with green values and margin badges
- [ ] Worst performers: 5 items with red/amber values and margin badges
- [ ] "Select trips to compare | Click headers to sort" note above table
- [ ] 12-row table with all 12 columns (including compare checkbox)
- [ ] 2 rows selected with checked checkboxes and blue-dim background
- [ ] Sort indicators (↕) on sortable column headers
- [ ] Revenue green, Fees/Pay/Expenses red, Net Profit color-coded
- [ ] Margin 4-tier: ≥20% green, 10-19% amber, 0-9% orange, <0% red
- [ ] 2 unprofitable trips with ($X) accounting format and red badges
- [ ] Comparison modal: 13-metric side-by-side table for 2 trips
- [ ] Winner highlighting in comparison table
- [ ] All money in monospace (tables), regular font (summary cards)
- [ ] Theme toggle works on all sections
- [ ] shared.css referenced, page-specific CSS under 120 lines
</verification>

<success_criteria>
Trip Profitability mockup faithfully reproduces the production trip profitability analysis page with filter controls, summary stats, best/worst performers, sortable comparison-enabled trips table with 4-tier margin color coding, and trip comparison modal, using Phase 6 design system with colored-dot indicators, accounting-format negatives, and working light/dark toggle.
</success_criteria>

<output>
After completion, create `.planning/phases/09-financial-pages/09-04-SUMMARY.md`
</output>
