---
phase: 09-financial-pages
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - mockups/web-tms-redesign/payroll.html
autonomous: false

must_haves:
  truths:
    - "Payroll page shows year filter dropdown defaulting to current year with last 4 years"
    - "Blue formula callout box displays Net Pay formula and note about COMPLETED trips / OTHER expenses"
    - "Driver settlement table shows 7 columns: Driver, Completed Trips, Gross Earnings, Cash Collected, Expense Reimb., Net Pay, Actions with View Paystub button"
    - "Payroll summary cards (4) show Total Gross, Total Cash Collected (red), Total Reimbursements (green), Total Net Payroll (green banner)"
    - "Company driver paystub modal shows trip selection with tree structure, deductions section (red), bonuses section (green), live net pay calculation, and Email/Print/PDF actions"
    - "Owner-operator settlement modal shows orange header, dispatch fee callout, settlement calculation (clean revenue - dispatch fee - cash collected), and Email/Print/PDF actions"
    - "Stat cards use colored-dot indicator style consistent with other financial pages"
    - "Light/dark theme toggle works correctly"
  artifacts:
    - path: "mockups/web-tms-redesign/payroll.html"
      provides: "Complete payroll page with settlement table and both modal variants"
      min_lines: 700
  key_links:
    - from: "payroll.html"
      to: "shared.css"
      via: "link rel stylesheet"
      pattern: 'href="./shared.css"'
    - from: "payroll.html"
      to: "base-template.html"
      via: "copied app shell (sidebar + header + page-content)"
      pattern: "class=\"app-layout\""
---

<objective>
Create the Payroll mockup page with year filter, formula callout, driver settlement table, payroll summary cards, and BOTH modal variants (company driver paystub with deductions/bonuses and owner-operator settlement with dispatch fee calculation).

Purpose: Payroll is a critical financial page that distinguishes company drivers from owner-operators with completely different payment flows. Both modal variants must be fully mocked up with realistic trip selection trees, deduction/bonus fields, and live calculation displays.

Output: `mockups/web-tms-redesign/payroll.html` — standalone HTML file with main payroll view + both modal variants visible.
</objective>

<execution_context>
@/Users/reepsy/.claude/get-shit-done/workflows/execute-plan.md
@/Users/reepsy/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-financial-pages/09-RESEARCH.md
@mockups/web-tms-redesign/shared.css
@mockups/web-tms-redesign/base-template.html
@mockups/web-tms-redesign/drivers.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create payroll.html with settlement table and both modal variants</name>
  <files>mockups/web-tms-redesign/payroll.html</files>
  <action>
Create `payroll.html` by copying the app shell from `base-template.html`. Set title to "Horizon Star TMS -- Payroll" and mark the Payroll nav item as `active`.

Inside `<div class="page-content">`, build the complete payroll page. Show modals as visible inline sections below the main view (this is a mockup — both modals rendered inline, not hidden).

**IMPORTANT CONSTRAINTS (from user decisions):**
- Green for positive money values, red for negative — accounting parentheses format ($X) for negatives
- Stat cards use colored-dot indicator style (small 8px colored circle next to label)
- Keep formula callout box (blue info banner)
- Both paystub (company driver) AND settlement (owner-operator) modals must be fully mocked
- Segmented pill-style tab bar if tabs are present
- Monospace for monetary values in tables; regular Inter font for hero/summary card values

---

## SECTION A: MAIN PAYROLL VIEW

**A1. Header Row**
- Title: "Payroll" with dollar-sign icon
- Right: year filter dropdown (pill-style, gray background) showing "2026" with options 2026, 2025, 2024, 2023

**A2. Formula Callout Box**
- Blue info banner styling: background var(--blue-dim), border-left 3px solid var(--blue), padding 16px, border-radius var(--radius)
- Icon: info circle or lightbulb
- Formula text (bold): `Net Pay = Gross Earnings − Cash Collected + Expense Reimbursements (OTHER only)`
- Note (text-secondary, smaller): "Only COMPLETED trips are included. Only 'OTHER' category expenses are reimbursed to drivers."

**A3. Driver Settlement Table**
- Table wrapper with standard table styling from shared.css
- 7 columns: Driver | Completed Trips | Gross Earnings | Cash Collected | Expense Reimb. | Net Pay | Actions
- Actions column is sticky right
- 6 data rows with realistic data (mix of company drivers and owner-operators):

Row 1 - John Smith (Company):
- 8 trips | $14,240.00 | $1,850.00 | $320.00 | $12,710.00 | "View Paystub" btn-primary btn-sm

Row 2 - Maria Garcia (Owner-OP):
- 6 trips | $19,680.00 | $0.00 | $0.00 | $19,680.00 | "View Settlement" btn-secondary btn-sm (orange-tinted)

Row 3 - David Chen (Company):
- 10 trips | $17,890.00 | $2,400.00 | $185.00 | $15,675.00 | "View Paystub" btn-primary btn-sm

Row 4 - Sarah Johnson (Owner-OP):
- 12 trips | $31,200.00 | $800.00 | $0.00 | $30,400.00 | "View Settlement" btn-secondary btn-sm

Row 5 - James Lee (Company):
- 4 trips | $6,840.00 | $950.00 | $110.00 | $6,000.00 | "View Paystub" btn-primary btn-sm

Row 6 - Robert Williams (Company):
- 2 trips | $3,120.00 | $400.00 | $75.00 | $2,795.00 | "View Paystub" btn-primary btn-sm

- Money values in table: monospace font, green for gross/reimb/net-pay, red for cash collected
- Owner-operator rows: subtle amber-dim left border or tinted background to differentiate

**A4. Payroll Summary Cards (4 cards, grid)**
Use `grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 16px;`
Each card has: colored dot (8px circle), label, large value

- Total Gross: colored dot green, "$92,970.00" (green text, large)
- Total Cash Collected: colored dot red, "$6,400.00" (red text, large)
- Total Reimbursements: colored dot green, "$690.00" (green text, large)
- Total Net Payroll: colored dot green, "$87,260.00" — this card gets a subtle green-dim background to emphasize it as the key total

---

## SECTION B: PAYSTUB MODAL (Company Driver — John Smith)

Use a visual separator heading: "PAYSTUB MODAL — Company Driver" between sections.

Render the modal as a card with max-width 650px, centered, with standard modal styling (bg-card, border, radius, shadow).

**B1. Modal Header**
- Title: "Generate Paystub" with document icon
- Subtitle: "John Smith — Company Driver"

**B2. Driver Info**
- Driver Name: "John Smith" (readonly field)
- Driver Email: "jsmith@example.com" (editable input field)

**B3. Trip Selection List**
- Scrollable container (max-height 300px, border, rounded)
- 3 trips with checkbox + tree structure:

Trip 1 (checked):
- "✓ Trip #T-2026-0042 — Jan 15, 2026 — Driver Cut: $1,920.00" (green)
- "├─ ORD-1042 — 2024 BMW X5 — $2,400.00 BILLED"
- "├─ ORD-1043 — 2023 Mercedes GLE — $1,800.00 BILLED"
- "└─ ORD-1044 — 2025 Audi Q7 — $2,200.00 COD — Cash: $650.00" (orange cash note)

Trip 2 (checked):
- "✓ Trip #T-2026-0038 — Jan 8, 2026 — Driver Cut: $1,440.00" (green)
- "├─ ORD-1036 — 2023 Toyota Camry — $1,200.00 BILLED"
- "└─ ORD-1037 — 2024 Honda CR-V — $1,600.00 COP"

Trip 3 (unchecked):
- "○ Trip #T-2026-0035 — Jan 3, 2026 — Driver Cut: $980.00"
- "└─ ORD-1030 — 2022 Ford F-150 — $1,400.00 BILLED"

**B4. Stub Info Fields (2-column grid)**
- Stub #: "4827" (readonly)
- Check #: "38291" (readonly)
- Period Starting: "2026-01-01" (date input)
- Period Ending: "2026-01-31" (date input)
- Pay Date: "2026-02-05" (date input)

**B5. Deductions Section**
- Red background card (red-dim background, border-left 3px solid var(--red))
- Header: "Deductions" with minus-circle icon
- 2-column grid of labeled input fields, each showing a dollar amount:
  - Insurance (Cargo/Liab/Phys): $180.00
  - Fuel: $420.00
  - Fuel Deposit: $50.00
  - ELD: $35.00
  - Tolls: $85.00
  - IFTA: $25.00
  - Highway Use Tax (2290): $0.00
  - Reg Renewal: $0.00
  - Other Deductions: $0.00
- Total Deductions: "$795.00" (bold, red text)

**B6. Bonuses Section**
- Green background card (green-dim background, border-left 3px solid var(--green))
- Header: "Bonuses" with plus-circle icon
- Fields:
  - Level I Inspection: $200.00
  - Level II Inspection: $0.00
  - Level III Inspection: $0.00
  - Other Bonus: $50.00
- Total Bonuses: "$250.00" (bold, green text)

**B7. Live Calculation Summary**
- Card with bg-elevated background, bold text:
  - Gross Pay: $3,360.00 (green)
  - − Deductions: ($795.00) (red, accounting parentheses)
  - + Bonuses: $250.00 (green)
  - Horizontal rule
  - **Net Pay: $2,815.00** (large, bold, green)

**B8. Action Buttons Row**
- "Email Paystub" (btn-primary), "Print" (btn-secondary), "Download PDF" (btn-secondary)

---

## SECTION C: SETTLEMENT MODAL (Owner-Operator — Maria Garcia)

Use a visual separator heading: "SETTLEMENT MODAL — Owner-Operator" between sections.

Render as a card with max-width 650px, centered.

**C1. Modal Header**
- Title: "Generate Settlement Statement" with clipboard icon
- Orange-tinted header area (amber-dim background)

**C2. Owner-Operator Callout Banner**
- Amber-dim background, border-left 3px solid var(--amber)
- Truck icon + "Owner-Operator Settlement"
- "Dispatch Fee: 15%" (bold)

**C3. Operator Info**
- Name: "Maria Garcia" (readonly)
- Email: "mgarcia@email.com" (editable input)

**C4. Trip Selection List**
- Same scrollable container style as paystub
- 2 trips with tree structure (orange amounts instead of green):

Trip 1 (checked):
- "✓ Trip #T-2026-0040 — Jan 12, 2026 — Settlement: $2,805.00" (orange)
- "├─ ORD-1039 — 2024 Tesla Model Y — $2,800.00 BILLED — Fee: $280.00"
- "└─ ORD-1040 — 2025 Rivian R1S — $3,500.00 BILLED — Fee: $350.00"

Trip 2 (checked):
- "✓ Trip #T-2026-0044 — Jan 18, 2026 — Settlement: $1,870.00" (orange)
- "└─ ORD-1046 — 2023 Porsche Cayenne — $2,200.00 BILLED — Fee: $330.00"

**C5. Settlement Info Fields (2-column grid)**
- Settlement #: "7834"
- Check #: "52917"
- Period Starting / Ending / Pay Date fields

**C6. Settlement Calculation Summary**
- Card with bg-elevated background:
  - Clean Revenue (Gross − Broker Fees): $8,500.00 (green)
  - − Dispatch Fee (15%): ($1,275.00) (red, accounting parentheses)
  - − Cash Collected: ($0.00)
  - Horizontal rule
  - **Settlement Amount: $7,225.00** (large, bold, orange/amber)

**C7. Action Buttons Row**
- "Email Settlement" (btn-primary), "Print" (btn-secondary), "Download PDF" (btn-secondary)

**Styling notes:**
- Page-specific CSS in `<style>` tag for: formula callout, trip selection tree, deductions/bonuses sections, modal card layout, live calculation summary. Keep under 120 lines.
- Tree structure uses `font-family: var(--font-mono); font-size: 12px; line-height: 1.6;` for the ├─ └─ characters
- Owner-operator rows in main table get `border-left: 3px solid var(--amber)` to distinguish
- All monetary values in tables and modals use `font-family: var(--font-mono)`
- Summary card values use regular Inter font, heavy weight
  </action>
  <verify>
Open `mockups/web-tms-redesign/payroll.html` in a browser. Verify:
1. Page loads without console errors
2. Year filter dropdown shows "2026" at top right
3. Blue formula callout box shows Net Pay formula
4. Settlement table shows 6 drivers with correct columns
5. Owner-operator rows (Maria Garcia, Sarah Johnson) are visually distinguished
6. 4 payroll summary cards show with colored dots
7. Total Net Payroll card has green-dim emphasis background
8. Paystub modal section shows trip tree structure with ├─ └─ prefixes
9. Deductions section (red) shows 9 fields with totals
10. Bonuses section (green) shows 4 fields with totals
11. Live calculation shows Gross − Deductions + Bonuses = Net Pay
12. Settlement modal section shows orange header and dispatch fee callout
13. Settlement calculation shows Clean Revenue − Dispatch Fee − Cash = Settlement Amount
14. Both modals have Email/Print/PDF action buttons
15. Theme toggle works on all sections
  </verify>
  <done>payroll.html exists with main payroll view (year filter, formula callout, 6-driver settlement table, 4 summary cards with colored dots), company driver paystub modal (trip tree, deductions, bonuses, net pay calculation), and owner-operator settlement modal (dispatch fee, settlement calculation), all using shared.css with working theme toggle</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete Payroll mockup with year filter, blue formula callout, 6-driver settlement table (company + owner-op distinction), 4 summary cards with colored-dot indicators, company driver paystub modal (trip selection tree, 9 deduction fields, 4 bonus fields, live net pay calculation, Email/Print/PDF), and owner-operator settlement modal (dispatch fee callout, settlement calculation, Email/Print/PDF).</what-built>
  <how-to-verify>
1. Open `mockups/web-tms-redesign/payroll.html` in your browser
2. Verify year filter dropdown at top right showing "2026"
3. Verify blue formula callout box with Net Pay formula
4. Verify 6-row driver settlement table with correct columns (Driver, Trips, Gross, Cash, Reimb, Net, Actions)
5. Verify owner-operator rows are visually distinct (amber border or tint)
6. Verify 4 summary cards with colored dots (Total Gross, Cash Collected, Reimbursements, Net Payroll)
7. Scroll to paystub modal — verify trip selection tree with ├─ └─ structure
8. Verify red deductions section with 9 fields and total
9. Verify green bonuses section with 4 fields and total
10. Verify live calculation: Gross − Deductions + Bonuses = Net Pay
11. Scroll to settlement modal — verify orange header and dispatch fee callout
12. Verify settlement calculation: Clean Revenue − Fee − Cash = Settlement
13. Check both modals have Email/Print/PDF buttons
14. Toggle dark/light theme — all sections should look clean
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
- [ ] payroll.html loads in browser without console errors
- [ ] Year filter dropdown with 4 years (current + 3 prior)
- [ ] Blue formula callout with Net Pay formula and note
- [ ] 6-row settlement table with correct 7 columns
- [ ] Owner-operator rows visually distinguished (amber border/tint)
- [ ] 4 summary cards with colored-dot indicators
- [ ] Total Net Payroll card has green-dim emphasis
- [ ] Paystub modal: driver info, trip tree (3 trips), stub/check numbers, period dates
- [ ] Paystub modal: deductions section (red, 9 fields), bonuses section (green, 4 fields)
- [ ] Paystub modal: live calculation (Gross − Deductions + Bonuses = Net Pay)
- [ ] Paystub modal: Email/Print/PDF buttons
- [ ] Settlement modal: orange header, dispatch fee callout
- [ ] Settlement modal: trip tree (2 trips), settlement info fields
- [ ] Settlement modal: calculation (Clean Revenue − Fee − Cash = Settlement)
- [ ] Settlement modal: Email/Print/PDF buttons
- [ ] All money values green (positive) or red with ($) accounting format (negative)
- [ ] Table money in monospace, summary cards in Inter
- [ ] Theme toggle works on all sections
- [ ] shared.css referenced, minimal page-specific CSS
</verification>

<success_criteria>
Payroll mockup faithfully reproduces the production payroll page with year filter, formula callout, driver settlement table (company + owner-op), payroll summary cards with colored-dot indicators, and both complete modal variants (paystub with deductions/bonuses and settlement with dispatch fee), using Phase 6 design system with accounting-format numbers and working light/dark toggle.
</success_criteria>

<output>
After completion, create `.planning/phases/09-financial-pages/09-01-SUMMARY.md`
</output>
