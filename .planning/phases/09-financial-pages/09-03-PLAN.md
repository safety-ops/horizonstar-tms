---
phase: 09-financial-pages
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - mockups/web-tms-redesign/financials.html
autonomous: false

must_haves:
  truths:
    - "Financials page has year selector dropdown and 8 segmented pill-style sub-tabs: Executive, Analysis, Overview, Costs, By Trip, By Driver, By Broker, By Lane"
    - "Executive tab shows health score hero (2 cards: current year + all time) with color-coded scores, grade, mini sub-score circles, AI optimization card, and 4 key metric cards"
    - "Analysis tab shows dark gradient hero banner with PROFITABLE/NEEDS ATTENTION status pill and 4 gradient KPI cards (Profit Per Car, Est Monthly Profit, Monthly Fixed Costs, Break-Even PPC)"
    - "Overview tab shows 4 summary cards, two-column revenue/expense breakdown, and 4 key metrics"
    - "Costs tab shows 4 summary cards, fuel card expenses card with mini stats, fixed costs table, and variable costs table"
    - "By Trip, By Driver, By Broker, and By Lane tabs each show summary stats and sortable tables with profit/margin color-coded columns"
    - "All 8 tabs have full content with realistic data — no placeholders or stubs"
    - "Light/dark theme toggle works correctly on all tabs"
  artifacts:
    - path: "mockups/web-tms-redesign/financials.html"
      provides: "Complete consolidated financials page with all 8 tabs"
      min_lines: 1200
  key_links:
    - from: "financials.html"
      to: "shared.css"
      via: "link rel stylesheet"
      pattern: 'href="./shared.css"'
    - from: "financials.html"
      to: "base-template.html"
      via: "copied app shell (sidebar + header + page-content)"
      pattern: "class=\"app-layout\""
---

<objective>
Create the Consolidated Financials mockup page with year selector and all 8 sub-tabs — Executive (health scores, AI optimization), Analysis (dark gradient hero, KPIs), Overview (revenue/expense breakdown), Costs (fixed/variable tables), By Trip, By Driver, By Broker, and By Lane (sortable breakdown tables) — each with full realistic content.

Purpose: Financials is the most complex page in the entire TMS with 8 distinct sub-views. Each tab provides a different analytical perspective on the business. The mockup must demonstrate the full depth of financial data visualization from executive health scores to per-lane profitability breakdowns.

Output: `mockups/web-tms-redesign/financials.html` — standalone HTML file with all 8 tabs and JavaScript tab switching.
</objective>

<execution_context>
@/Users/reepsy/.claude/get-shit-done/workflows/execute-plan.md
@/Users/reepsy/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-financial-pages/09-RESEARCH.md
@mockups/web-tms-redesign/shared.css
@mockups/web-tms-redesign/base-template.html
@mockups/web-tms-redesign/dashboard.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create financials.html with all 8 sub-tabs</name>
  <files>mockups/web-tms-redesign/financials.html</files>
  <action>
Create `financials.html` by copying the app shell from `base-template.html`. Set title to "Horizon Star TMS -- Financials" and mark the Financials nav item as `active`.

Inside `<div class="page-content">`, build the complete financials page with JavaScript tab switching across 8 sub-tabs. Default to Executive tab active.

**IMPORTANT CONSTRAINTS (from user decisions):**
- All 8 sub-tabs must have FULL content with realistic data — no stubs
- Segmented pill-style tab bar for all 8 tabs
- Stat cards use colored-dot indicator style
- Green positive, red negative, ($X) accounting parentheses
- Percentages: 3-tier color thresholds (green healthy, amber warning, red concern)
- Monospace for monetary values in tables; regular Inter font for hero/summary values
- Financial Health Dashboard hero with PROFITABLE/NEEDS ATTENTION pill — keep this pattern, it fits the design system with dark gradient treatment
- Profit/loss indicators: bold colored text for key metrics

---

## PAGE HEADER

- Title: "Financial Analysis" with bar-chart-3 icon
- Right: Year selector dropdown (pill-style, gray background) showing "2026" with options 2026, 2025, 2024, 2023

## TAB BAR (8 tabs)

Segmented pill-style tab bar (allow horizontal scroll on narrow screens):
- Wrapper: `display: flex; overflow-x: auto; background: var(--bg-elevated); border-radius: var(--radius); padding: 3px; gap: 2px;`
- 8 tabs: "Executive" (active), "Analysis", "Overview", "Costs", "By Trip", "By Driver", "By Broker", "By Lane"
- Tab buttons: `white-space: nowrap; padding: 8px 14px;`
- JavaScript onclick toggles tabs

---

## TAB 1: EXECUTIVE (default active)

**1A. Health Score Hero (2 cards side-by-side, flex row, gap 16px)**

**Current Year Card (flex: 2):**
- Gradient background: `linear-gradient(135deg, rgba(34,197,94,0.08) 0%, rgba(34,197,94,0.02) 100%)`
- Border: 2px solid var(--green) (because score >= 80)
- Border-radius: var(--radius-lg)
- Padding: 24px
- Left side:
  - Year badge: "2026" (text-secondary)
  - Score: "82/100" (48px, bold 800, var(--green))
  - Grade: "A-" (24px, bold, var(--green))
  - Based on: "42 trips" (text-muted)
- Right side: 4 mini score circles (50px each):
  - Profitability: 85% (green border)
  - Efficiency: 78% (amber border)
  - Utilization: 80% (green border)
  - Growth: 72% (amber border)
  - Each circle: `width: 50px; height: 50px; border-radius: 50%; border: 3px solid [color]; display: flex; align-items: center; justify-content: center; font-size: 13px; font-weight: 700;`

**All Time Card (flex: 1, min-width 200px):**
- Gradient background with green 15% opacity
- Score: "76/100" (36px, bold, var(--green))
- Grade: "B+" + "186 trips"

**1B. AI Optimization Card**
- Card with orange gradient header: `linear-gradient(135deg, var(--amber) 0%, #fbbf24 100%)`
- Header (white text): "AI-Powered Optimization Recommendations" with lightbulb icon
- Body (bg-card): bullet list of 4 recommendations:
  - "Increase load density on NY→FL lane — current avg 3.2 cars, capacity suggests 4.5+"
  - "Negotiate 2% lower broker fees with Central Dispatch — volume justifies discount"
  - "Reduce deadhead miles by 12% by accepting return loads from FL→NY"
  - "Consider fuel hedging — current fuel costs trending 8% above last year"

**1C. Key Metrics Row (4 stat cards)**
Use `grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 16px;`
Each card: border-left 4px solid [color], bg-card, padding 16px

1. Total Revenue: green border, "$487,320.00" (large, green), "↑ 12% vs last year" (text-secondary)
2. Net Profit: green border (positive), "$68,240.00" (large, green), "14.0% margin" (badge-green)
3. Cash Position: blue border, "$42,180.00" (large, blue text), "Collected this year" (text-secondary)
4. Trip Volume: purple border, "42 trips" (large, purple text), "186 cars transported" (text-secondary)

---

## TAB 2: ANALYSIS (initially hidden)

**2A. Dark Gradient Hero Banner**
- Background: `linear-gradient(135deg, #1e293b 0%, #334155 100%)`
- Padding: 24px, border-radius: var(--radius-lg)
- Flex row, justify-content: space-between

Left side:
- H3: "Financial Health Dashboard" (white, 24px, bold)
- Subtitle: "All-time analysis • 186 trips • 892 cars • 245,680 miles" (#94a3b8, 14px)

Right side:
- Status pill: `display: inline-flex; align-items: center; gap: 6px; padding: 6px 14px; border-radius: 20px;`
- Background: rgba(34,197,94,0.2), border: 1px solid #22c55e
- Green dot (8px circle) + "PROFITABLE" (green #4ade80, 13px, bold, uppercase, letter-spacing)

**2B. Hero Stats Row (4 gradient KPI cards)**
Grid: `repeat(auto-fit, minmax(220px, 1fr)); gap: 16px; margin-top: 20px;`

Card 1 — Profit Per Car:
- Gradient: `linear-gradient(135deg, rgba(34,197,94,0.15) 0%, rgba(34,197,94,0.05) 100%)`
- Label: "PROFIT PER CAR" (11px, uppercase, letter-spacing 1px, text-secondary)
- Value: "$76.50" (36px, bold 800, var(--green))
- Subtitle: "After all costs incl. fixed" (12px, text-muted)

Card 2 — Est. Monthly Profit:
- Gradient: `linear-gradient(135deg, rgba(59,130,246,0.15) 0%, rgba(59,130,246,0.05) 100%)`
- Label: "EST. MONTHLY PROFIT"
- Value: "$5,687.00" (36px, bold, var(--green) since positive)
- Subtitle: "Based on last 3 months avg"

Card 3 — Monthly Fixed Costs:
- Gradient: `linear-gradient(135deg, rgba(245,158,11,0.15) 0%, rgba(245,158,11,0.05) 100%)`
- Label: "MONTHLY FIXED COSTS"
- Value: "$9,840.00" (36px, bold, var(--red))
- Subtitle: "$2,460/truck (4 trucks)"

Card 4 — Break-Even PPC:
- Gradient: `linear-gradient(135deg, rgba(168,85,247,0.15) 0%, rgba(168,85,247,0.05) 100%)`
- Label: "BREAK-EVEN PPC"
- Value: "$198.50" (36px, bold, var(--purple))
- Subtitle: "Actual: $275.00 (+$76.50 above)" (green text, meaning profitable above break-even)

---

## TAB 3: OVERVIEW (initially hidden)

**3A. Summary Cards (4 cards)**
Grid with colored-dot indicators:
1. Total Revenue: green dot, "$487,320.00"
2. Clean Revenue: blue dot, "$438,588.00" (after broker fees)
3. Net Profit: green dot, "$68,240.00"
4. Profit / Car: green dot, "$76.50"

**3B. Two-Column Breakdown (flex row, gap 16px)**

Left Card: "Revenue Breakdown" with trending-up icon
- Gross Revenue: $487,320.00 (green)
- − Broker Fees: ($38,985.60) (red, accounting format)
- − Local Fees: ($9,746.40) (red)
- Horizontal rule
- = Clean Revenue: $438,588.00 (green, bold, larger)

Right Card: "Expenses Breakdown" with trending-down icon
- Driver Pay: ($185,182.80) (red)
- Trip Expenses: ($42,650.00) (red)
- Variable Costs: ($28,420.00) (red)
- Fixed Costs (monthly × 12): ($118,080.00) (red)
- Horizontal rule
- = Total Expenses: ($374,332.80) (red, bold, larger)

**3C. Key Metrics Card**
Grid of 4 centered metrics:
- Revenue / Mile: "$1.98" (green, 24px bold)
- Profit / Mile: "$0.28" (green, 24px bold)
- Avg Revenue / Car: "$546.30" (blue, 24px bold)
- Total Miles: "245,680" (purple, 24px bold)

---

## TAB 4: COSTS (initially hidden)

**4A. Summary Cards (4 cards with colored dots)**
1. Monthly Fixed: red dot, "$9,840.00/mo"
2. Total Variable: amber dot, "$28,420.00"
3. Fuel (records): red dot, "$18,650.00"
4. Maintenance: amber dot, "$6,230.00"

**4B. Fuel Card Expenses Card**
- Border-left 4px solid var(--red)
- Header: "Fuel Card Expenses" + total "$14,280.00" (red, large)
- Body with red-dim background:
  - 4 mini stats (grid 2x2):
    - Transactions: "87"
    - Total Gallons: "4,260"
    - Avg $/Gallon: "$3.35"
    - Avg per Fill: "$164.14"
- Footer link: "View Fuel Tracking →"

**4C. Fixed Costs Table**
- Section header: "Fixed Monthly Costs"
- Columns: Category | Name | Amount | Actions
- 6 rows:
  1. badge-blue "Insurance" | Cargo Insurance | $1,200.00/mo | Edit, Del
  2. badge-blue "Insurance" | Liability Insurance | $850.00/mo | Edit, Del
  3. badge-blue "Insurance" | Physical Damage | $620.00/mo | Edit, Del
  4. badge-purple "Payment" | Truck Payment (T-101) | $2,400.00/mo | Edit, Del
  5. badge-purple "Payment" | Truck Payment (T-102) | $2,200.00/mo | Edit, Del
  6. badge-amber "Operating" | Permits & Licensing | $570.00/mo | Edit, Del
- Footer row: Total: $9,840.00/mo (bold)

**4D. Variable Costs Table**
- Section header: "Variable Costs (Year to Date)"
- Columns: Date | Category | Description | Amount | Actions
- 5 rows:
  1. Jan 28, 2026 | badge-red "Fuel" | Diesel - Pilot Travel #2847 | $485.00 | Edit, Del
  2. Jan 22, 2026 | badge-amber "Maintenance" | Oil change - T-101 | $320.00 | Edit, Del
  3. Jan 15, 2026 | badge-blue "Tolls" | E-ZPass monthly | $280.00 | Edit, Del
  4. Jan 8, 2026 | badge-red "Fuel" | Diesel - Love's #1923 | $510.00 | Edit, Del
  5. Jan 3, 2026 | badge-amber "Maintenance" | Tire rotation - T-102 | $180.00 | Edit, Del

---

## TAB 5: BY TRIP (initially hidden)

**5A. Summary Stats (3 cards with colored dots)**
- Total Trips: blue dot, "42"
- Avg Revenue/Trip: green dot, "$11,603.00"
- Avg Margin: green dot, "14.0%"

**5B. Trip Table (sortable)**
- Columns: Trip # | Date | Driver | Cars | Revenue | Costs | Net Profit | Margin %
- Sort indicators: ↕ on all columns
- 8 rows with varied profitability:
  1. T-2026-0042 | Jan 28 | John Smith | 5 | $12,400.00 | $9,200.00 | $3,200.00 (green) | 25.8% (badge-green)
  2. T-2026-0040 | Jan 22 | Maria Garcia | 4 | $10,800.00 | $7,920.00 | $2,880.00 (green) | 26.7% (badge-green)
  3. T-2026-0038 | Jan 15 | David Chen | 6 | $14,200.00 | $11,400.00 | $2,800.00 (green) | 19.7% (badge-amber)
  4. T-2026-0035 | Jan 8 | James Lee | 3 | $7,600.00 | $6,080.00 | $1,520.00 (green) | 20.0% (badge-green)
  5. T-2026-0032 | Jan 3 | Sarah Johnson | 5 | $13,500.00 | $11,200.00 | $2,300.00 (green) | 17.0% (badge-amber)
  6. T-2026-0030 | Dec 28 | John Smith | 4 | $9,800.00 | $8,820.00 | $980.00 (green) | 10.0% (badge-amber)
  7. T-2026-0028 | Dec 22 | David Chen | 3 | $6,400.00 | $6,080.00 | $320.00 (green) | 5.0% (badge-orange)
  8. T-2026-0025 | Dec 15 | Robert Williams | 2 | $4,200.00 | $4,620.00 | ($420.00) (red) | -10.0% (badge-red)

---

## TAB 6: BY DRIVER (initially hidden)

**6A. Summary Stats (3 cards)**
- Active Drivers: blue dot, "5"
- Top Earner: green dot, "Maria Garcia"
- Avg Margin: green dot, "15.2%"

**6B. Driver Table**
- Columns: Driver | Type | Trips | Cars | Revenue | Costs | Net Profit | Margin %
- 5 rows:
  1. John Smith | Company | 12 | 48 | $58,200.00 | $47,120.00 | $11,080.00 (green) | 19.0% (badge-amber)
  2. Maria Garcia | Owner-OP | 8 | 32 | $72,400.00 | $58,620.00 | $13,780.00 (green) | 19.0% (badge-amber)
  3. David Chen | Company | 10 | 42 | $51,600.00 | $43,860.00 | $7,740.00 (green) | 15.0% (badge-amber)
  4. Sarah Johnson | Owner-OP | 8 | 35 | $68,500.00 | $57,540.00 | $10,960.00 (green) | 16.0% (badge-amber)
  5. James Lee | Company | 4 | 14 | $28,400.00 | $22,720.00 | $5,680.00 (green) | 20.0% (badge-green)

---

## TAB 7: BY BROKER (initially hidden)

**7A. Summary Stats (3 cards)**
- Active Brokers: blue dot, "5"
- Highest Revenue: green dot, "Central Dispatch"
- Avg Fee %: amber dot, "9.8%"

**7B. Broker Table**
- Columns: Broker | Loads | Revenue | Broker Fees | Net After Fees | Fee % | Avg Rate/Load
- 5 rows:
  1. Central Dispatch | 45 | $83,250.00 | $7,425.00 | $75,825.00 | 8.9% (badge-green) | $1,850.00
  2. Super Dispatch | 38 | $61,560.00 | $7,410.00 | $54,150.00 | 12.0% (badge-amber) | $1,620.00
  3. LoadMax | 28 | $41,440.00 | $4,144.00 | $37,296.00 | 10.0% (badge-amber) | $1,480.00
  4. Ship.Cars | 15 | $20,100.00 | $3,015.00 | $17,085.00 | 15.0% (badge-red) | $1,340.00
  5. QuickShip Transport | 22 | $34,100.00 | $3,740.00 | $30,360.00 | 11.0% (badge-amber) | $1,550.00

---

## TAB 8: BY LANE (initially hidden)

**8A. Summary Stats (3 cards)**
- Active Lanes: blue dot, "4"
- Most Profitable: green dot, "NY → FL"
- Avg Cars/Lane: purple dot, "223"

**8B. Lane Table**
- Columns: Lane | Trips | Cars | Revenue | Costs | Net Profit | Margin % | RPM
- 4 rows:
  1. NY → FL | 18 | 86 | $198,400.00 | $152,170.00 | $46,230.00 (green) | 23.3% (badge-green) | $1.62
  2. FL → NY | 12 | 52 | $124,800.00 | $101,090.00 | $23,710.00 (green) | 19.0% (badge-amber) | $1.48
  3. Home → NY | 8 | 28 | $78,400.00 | $68,520.00 | $9,880.00 (green) | 12.6% (badge-amber) | $1.35
  4. NY → Home | 4 | 14 | $42,000.00 | $38,640.00 | $3,360.00 (green) | 8.0% (badge-orange) | $1.18

---

**Styling notes:**
- Page-specific CSS in `<style>` tag for: 8-tab bar scroll behavior, health score circles, gradient KPI cards, dark gradient hero, status pill, AI card gradient header, two-column breakdown, fuel card. Target 150-180 lines max.
- Tab bar: `overflow-x: auto; -webkit-overflow-scrolling: touch;` for narrow screens
- Health score circles: bordered circles (not filled) with percentage inside
- Gradient KPI cards: each gets a different gradient background at 15% opacity
- PROFITABLE pill: green dot + green text on transparent green bg
- All table money values: monospace font
- Margin badges: ≥20% green, 10-19% amber, 0-9% orange, <0% red
- Fee % in broker table: ≤10% green, 11-14% amber, ≥15% red
  </action>
  <verify>
Open `mockups/web-tms-redesign/financials.html` in a browser. Verify:
1. Page loads without console errors
2. Year selector dropdown shows "2026"
3. 8 segmented pill tabs are visible (scrollable on narrow screens)
4. EXECUTIVE: Health score hero shows 82/100 (green), A- grade, 4 mini circles
5. EXECUTIVE: All Time card shows 76/100, B+
6. EXECUTIVE: AI optimization card with orange gradient header and 4 bullet points
7. EXECUTIVE: 4 key metric cards with colored left borders
8. Click Analysis tab → dark gradient hero with "PROFITABLE" green pill
9. ANALYSIS: 4 gradient KPI cards with large values
10. Click Overview → 4 summary cards, two-column breakdown, 4 key metrics
11. Click Costs → summary cards, fuel card with mini stats, fixed costs table, variable costs table
12. Click By Trip → 8-row table with profit/margin color coding
13. Click By Driver → 5-row driver breakdown
14. Click By Broker → 5-row broker breakdown with fee %
15. Click By Lane → 4-row lane breakdown with RPM
16. Theme toggle works on ALL 8 tabs
  </verify>
  <done>financials.html exists with all 8 sub-tabs fully populated — Executive (health scores, AI card, key metrics), Analysis (dark gradient hero, PROFITABLE pill, 4 KPI cards), Overview (revenue/expense breakdown), Costs (fuel card, fixed/variable tables), By Trip (8 rows), By Driver (5 rows), By Broker (5 rows), By Lane (4 rows) — with tab switching, colored-dot stat cards, and working theme toggle</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete Consolidated Financials mockup with year selector and all 8 sub-tabs fully populated: Executive (health score hero with mini circles, AI optimization card, key metrics), Analysis (dark gradient hero with PROFITABLE status pill, 4 gradient KPI cards), Overview (summary cards, revenue/expense breakdown, key metrics), Costs (summary cards, fuel card expenses, fixed costs table, variable costs table), By Trip (8-row sortable table), By Driver (5-row table), By Broker (5-row table with fee %), By Lane (4-row table with RPM). JavaScript tab switching included.</what-built>
  <how-to-verify>
1. Open `mockups/web-tms-redesign/financials.html` in your browser
2. Verify 8 segmented pill tabs in the tab bar
3. EXECUTIVE: Check health score 82/100 (green border), A- grade, 4 mini score circles
4. EXECUTIVE: Check AI optimization card with orange gradient header
5. EXECUTIVE: Check 4 key metric cards (Revenue, Profit, Cash, Trips)
6. Click "Analysis" — verify dark gradient hero with PROFITABLE green pill
7. ANALYSIS: Verify 4 gradient KPI cards (Profit/Car, Monthly Profit, Fixed Costs, Break-Even)
8. Click "Overview" — verify two-column Revenue/Expense breakdown
9. Click "Costs" — verify fuel card with mini stats grid, fixed costs table (6 rows), variable costs table (5 rows)
10. Click "By Trip" — verify 8 rows with green/red profit and colored margin badges
11. Click "By Driver" — verify 5 drivers with profit/margin data
12. Click "By Broker" — verify 5 brokers with fee % badges
13. Click "By Lane" — verify 4 lanes with RPM column
14. Toggle dark/light theme — all 8 tabs should look clean
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
- [ ] financials.html loads in browser without console errors
- [ ] Year selector dropdown with 4 years
- [ ] 8 segmented pill tabs with JavaScript switching, scrollable on narrow screens
- [ ] Executive: Health score hero (current year 82/100 green + all time 76/100)
- [ ] Executive: 4 mini score circles with colored borders
- [ ] Executive: AI optimization card with orange gradient header
- [ ] Executive: 4 key metric cards with colored left borders
- [ ] Analysis: Dark gradient hero banner (#1e293b to #334155)
- [ ] Analysis: PROFITABLE green status pill (green dot + text)
- [ ] Analysis: 4 gradient KPI cards with large values
- [ ] Overview: 4 summary cards with colored dots
- [ ] Overview: Two-column revenue/expense breakdown with totals
- [ ] Overview: 4 centered key metrics (RPM, PPM, Avg Rev/Car, Total Miles)
- [ ] Costs: 4 summary cards, fuel card with mini stats
- [ ] Costs: Fixed costs table (6 rows with category badges)
- [ ] Costs: Variable costs table (5 rows with dates and categories)
- [ ] By Trip: 8-row table with margin color coding (green/amber/orange/red)
- [ ] By Driver: 5-row table with type column
- [ ] By Broker: 5-row table with fee % color coding
- [ ] By Lane: 4-row table with RPM column
- [ ] All money in monospace (tables), regular font (hero/summary cards)
- [ ] Accounting parentheses ($X) for negative values
- [ ] Theme toggle works on all 8 tabs
- [ ] shared.css referenced, page-specific CSS under 180 lines
</verification>

<success_criteria>
Financials mockup faithfully reproduces the production consolidated financials page with all 8 sub-tabs fully populated with realistic data, health score visualizations, dark gradient hero, gradient KPI cards, revenue/expense breakdowns, cost tables, and per-dimension breakdown tables (trip/driver/broker/lane), using Phase 6 design system with colored-dot indicators, margin color coding, and working light/dark toggle.
</success_criteria>

<output>
After completion, create `.planning/phases/09-financial-pages/09-03-SUMMARY.md`
</output>
